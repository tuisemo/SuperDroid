# SuperDroid Factory é…ç½®æŒ‡å—

## ğŸ“ é…ç½®ç»“æ„

```
.factory/
â”œâ”€â”€ settings.json              # ä¸»é…ç½®æ–‡ä»¶ï¼ˆhooks é…ç½®ï¼‰
â”œâ”€â”€ .droid.yaml               # Droid è¡Œä¸ºé…ç½®
â”œâ”€â”€ mcp.json                  # MCP æœåŠ¡å™¨é…ç½®ï¼ˆç©ºï¼Œå¾…æ‰©å±•ï¼‰
â”œâ”€â”€ lessons.md                # ç»éªŒå­¦ä¹ è®°å½•
â”œâ”€â”€ PLAN.md                   # é¡¹ç›®è®¡åˆ’
â”œâ”€â”€ hooks/                    # Hook è„šæœ¬
â”‚   â”œâ”€â”€ session-init-check.ps1      # ä¼šè¯åˆå§‹åŒ–æ£€æŸ¥
â”‚   â”œâ”€â”€ command-validator.ps1       # å‘½ä»¤éªŒè¯
â”‚   â”œâ”€â”€ enhanced-file-protect.ps1   # æ–‡ä»¶ä¿æŠ¤
â”‚   â”œâ”€â”€ pre-read-analyzer.ps1       # é¢„è¯»åˆ†æ
â”‚   â”œâ”€â”€ auto-format.ps1             # è‡ªåŠ¨æ ¼å¼åŒ–
â”‚   â”œâ”€â”€ subtask-validator.ps1       # å­ä»»åŠ¡éªŒè¯
â”‚   â”œâ”€â”€ pre-compact-warn.ps1        # å‹ç¼©å‰è­¦å‘Š
â”‚   â”œâ”€â”€ session-summaries.ps1       # ä¼šè¯æ€»ç»“
â”‚   â””â”€â”€ session-cleanup.ps1         # ä¼šè¯æ¸…ç†
â”œâ”€â”€ skills/                   # æŠ€èƒ½å®šä¹‰
â”‚   â”œâ”€â”€ task-planner/        # ä»»åŠ¡è§„åˆ’ï¼ˆå¢å¼ºç‰ˆï¼Œå«éœ€æ±‚åˆ†æï¼‰
â”‚   â”œâ”€â”€ code-review/         # ä»£ç å®¡æŸ¥ï¼ˆå¢å¼ºç‰ˆï¼‰
â”‚   â”œâ”€â”€ technical-report/    # æŠ€æœ¯æŠ¥å‘Š
â”‚   â”œâ”€â”€ web-researcher/      # ç½‘ç»œç ”ç©¶
â”‚   â”œâ”€â”€ architecture-review/ # æ¶æ„è¯„å®¡
â”‚   â”œâ”€â”€ plan-critique-fix/   # è®¡åˆ’æ‰¹è¯„ä¸ä¿®å¤
â”‚   â”œâ”€â”€ auto-test-and-fix/   # è‡ªåŠ¨æµ‹è¯•ä¸ä¿®å¤
â”‚   â””â”€â”€ doc-generator/       # æ–‡æ¡£ç”Ÿæˆ
â”œâ”€â”€ droids/                   # å­ä»£ç†å®šä¹‰
â”‚   â”œâ”€â”€ supervisor.md        # ä¸»ç®¡ï¼ˆä¸»æ§ï¼‰
â”‚   â”œâ”€â”€ coder.md             # ç¼–ç å™¨
â”‚   â”œâ”€â”€ researcher.md        # ç ”ç©¶å‘˜
â”‚   â”œâ”€â”€ tester-enhanced.md   # æµ‹è¯•å‘˜ï¼ˆå¢å¼ºç‰ˆï¼‰
â”‚   â”œâ”€â”€ security-auditor.md  # å®‰å…¨å®¡è®¡å‘˜
â”‚   â””â”€â”€ improver.md          # æ”¹è¿›è€…
â””â”€â”€ scripts/                  # å·¥å…·è„šæœ¬
    â””â”€â”€ setup-tools.ps1      # å·¥å…·å®‰è£…è„šæœ¬
```

## ğŸª Hooks é…ç½®

### Hook äº‹ä»¶è¯´æ˜

| äº‹ä»¶ | è§¦å‘æ—¶æœº | ç”¨é€” | é˜»æ–­èƒ½åŠ› |
|------|----------|------|----------|
| `SessionStart` | ä¼šè¯å¼€å§‹ | åˆå§‹åŒ–æ£€æŸ¥ã€ç¯å¢ƒéªŒè¯ | âŒ |
| `UserPromptSubmit` | ç”¨æˆ·æäº¤æç¤º | å‘½ä»¤éªŒè¯ã€å®‰å…¨æ£€æŸ¥ | âœ… |
| `PreToolUse` | å·¥å…·è°ƒç”¨å‰ | æ–‡ä»¶ä¿æŠ¤ã€é¢„è¯»åˆ†æ | âœ… |
| `PostToolUse` | å·¥å…·è°ƒç”¨å | è‡ªåŠ¨æ ¼å¼åŒ–ã€è´¨é‡æ£€æŸ¥ | âŒ |
| `SubagentStop` | å­ä»£ç†å®Œæˆ | ç»“æœéªŒè¯ã€è´¨é‡è¯„åˆ† | âŒ |
| `PreCompact` | ä¼šè¯å‹ç¼©å‰ | è­¦å‘Šç”¨æˆ·ä¿å­˜ä¸Šä¸‹æ–‡ | âŒ |
| `Stop` | å“åº”å®Œæˆ | ä¼šè¯æ€»ç»“ | âŒ |
| `SessionEnd` | ä¼šè¯ç»“æŸ | æ¸…ç†èµ„æº | âŒ |

### å½“å‰ Hooks

| Hook è„šæœ¬ | è§¦å‘äº‹ä»¶ | åŠŸèƒ½ | Timeout |
|-----------|----------|------|---------|
| `session-init-check.ps1` | SessionStart | ç¯å¢ƒæ£€æŸ¥ã€ä¾èµ–éªŒè¯ | 30s |
| `command-validator.ps1` | UserPromptSubmit | å±é™©å‘½ä»¤æ‹¦æˆª | 5s |
| `enhanced-file-protect.ps1` | PreToolUse | æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤ | 5s |
| `pre-read-analyzer.ps1` | PreToolUse | å¤§æ–‡ä»¶é¢„è­¦ | 3s |
| `auto-format.ps1` | PostToolUse | ä»£ç è‡ªåŠ¨æ ¼å¼åŒ– | 45s |
| `subtask-validator.ps1` | SubagentStop | å­ä»»åŠ¡è¯„åˆ† | 10s |
| `pre-compact-warn.ps1` | PreCompact | å‹ç¼©å‰è­¦å‘Š | 5s |
| `session-summaries.ps1` | Stop | ä¼šè¯æ‘˜è¦ | 15s |
| `session-cleanup.ps1` | SessionEnd | èµ„æºæ¸…ç† | 20s |

## ğŸ¯ Skills æŠ€èƒ½

### æ ¸å¿ƒæŠ€èƒ½

| æŠ€èƒ½ | æè¿° | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|
| `task-planner` | ä»»åŠ¡è§„åˆ’ä¸éœ€æ±‚åˆ†æ | ç”¨æˆ·éœ€æ±‚ | ç»“æ„åŒ–æ‰§è¡Œè®¡åˆ’ |
| `code-review` | ä»£ç å®¡æŸ¥ | ä»£ç æ–‡ä»¶ | å®¡æŸ¥æŠ¥å‘Š |
| `technical-report` | æŠ€æœ¯æŠ¥å‘Šç”Ÿæˆ | æŠ€æœ¯ä¿¡æ¯ | ä¸“ä¸šæŠ¥å‘Š |
| `web-researcher` | ç½‘ç»œç ”ç©¶ | ç ”ç©¶ä¸»é¢˜ | è°ƒç ”æŠ¥å‘Š |
| `architecture-review` | æ¶æ„è¯„å®¡ | é¡¹ç›®ç»“æ„ | æ¶æ„åˆ†ææŠ¥å‘Š |
| `auto-test-and-fix` | è‡ªåŠ¨æµ‹è¯•ä¿®å¤ | æµ‹è¯•å¤±è´¥ | ä¿®å¤æ–¹æ¡ˆ |
| `plan-critique-fix` | è®¡åˆ’æ‰¹è¯„ä¿®å¤ | å½“å‰è®¡åˆ’ | æ”¹è¿›å»ºè®® |
| `doc-generator` | æ–‡æ¡£ç”Ÿæˆ | ä»£ç /é…ç½® | æŠ€æœ¯æ–‡æ¡£ |

## ğŸ¤– Droids å­ä»£ç†

| å­ä»£ç† | è§’è‰² | å·¥å…· | èŒè´£ |
|--------|------|------|------|
| `supervisor` | ä¸»ç®¡ | Read, LS, Grep, Glob, TodoWrite | ä»»åŠ¡ç¼–æ’ã€è¿›åº¦ç›‘æ§ |
| `coder` | ç¼–ç å™¨ | Edit, Write, Read, Grep, Glob | ä»£ç å®ç° |
| `researcher` | ç ”ç©¶å‘˜ | Read, Grep, WebSearch, FetchUrl | æŠ€æœ¯ç ”ç©¶ |
| `tester-enhanced` | æµ‹è¯•å‘˜ | Read, Execute, Grep | æµ‹è¯•æ‰§è¡Œã€æ ¹å› åˆ†æ |
| `security-auditor` | å®‰å…¨å®¡è®¡å‘˜ | Read, Grep | å®‰å…¨æ¼æ´æ‰«æ |
| `improver` | æ”¹è¿›è€… | Read | ç»éªŒæå–ã€è‡ªæˆ‘æ”¹è¿› |

## ğŸ“ é…ç½®è§„èŒƒ

### settings.json ç»“æ„

```json
{
  "hooks": {
    "EventName": [
      {
        "matcher": "ToolPattern|*",
        "hooks": [
          {
            "type": "command",
            "command": "powershell -File \"$env:FACTORY_PROJECT_DIR/.factory/hooks/script.ps1\"",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
```

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | ä½¿ç”¨ç¤ºä¾‹ |
|------|------|----------|
| `$FACTORY_PROJECT_DIR` | é¡¹ç›®æ ¹ç›®å½• | `"$env:FACTORY_PROJECT_DIR\.factory\hooks\script.ps1"` |
| `${DROID_PLUGIN_ROOT}` | æ’ä»¶æ ¹ç›®å½•ï¼ˆä»…æ’ä»¶ä½¿ç”¨ï¼‰ | - |

### Exit Codes

| ç¼–ç  | å«ä¹‰ | è¡Œä¸º |
|------|------|------|
| `0` | æˆåŠŸ | ç»§ç»­æ‰§è¡Œ |
| `2` | é˜»æ–­ | é˜»æ­¢å·¥å…·/æç¤ºå¤„ç†ï¼Œstderr åé¦ˆç»™ AI |
| å…¶ä»– | é”™è¯¯ | éé˜»æ–­ï¼Œstderr æ˜¾ç¤ºç»™ç”¨æˆ· |

## ğŸ”§ æœ€ä½³å®è·µ

### Hooks ç¼–å†™

1. **ä½¿ç”¨ç»å¯¹è·¯å¾„**ï¼šå§‹ç»ˆä½¿ç”¨ `$FACTORY_PROJECT_DIR`
2. **è®¾ç½®åˆç† timeout**ï¼šç®€å•æ£€æŸ¥ 3-5sï¼Œå¤æ‚æ“ä½œ 30-45s
3. **æ­£ç¡®å¤„ç† stdin**ï¼šHooks é€šè¿‡ stdin æ¥æ”¶ JSON è¾“å…¥
4. **å¹‚ç­‰æ€§è®¾è®¡**ï¼šåŒä¸€äº‹ä»¶å¯å¤šæ¬¡è§¦å‘ï¼Œç»“æœä¸€è‡´
5. **å¿«é€Ÿå¤±è´¥**ï¼šæœ‰é—®é¢˜å°½æ—©é€€å‡ºï¼Œé¿å…æµªè´¹æ—¶é—´
6. **æ—¥å¿—è®°å½•**ï¼šè®°å½•åˆ° `.factory/logs/` ä¾¿äºè°ƒè¯•

### Skills ç¼–å†™

1. **æ¸…æ™°çš„è¾“å…¥è¾“å‡ºæ ¼å¼**ï¼šä½¿ç”¨æ¨¡æ¿å®šä¹‰æ•°æ®ç»“æ„
2. **å…·ä½“çš„ç¤ºä¾‹**ï¼šæä¾›è¾“å…¥è¾“å‡ºç¤ºä¾‹
3. **éªŒè¯æ¸…å•**ï¼šæ‰§è¡Œå‰åè‡ªæ£€
4. **é”™è¯¯å¤„ç†**ï¼šå®šä¹‰å¤±è´¥æ—¶çš„è¡Œä¸º

### Droids ç¼–å†™

1. **æ˜ç¡®çš„èŒè´£è¾¹ç•Œ**ï¼šæ¯ä¸ª droid ä¸“æ³¨å•ä¸€èŒè´£
2. **å¿…è¦çš„å·¥å…·å£°æ˜**ï¼šåªå£°æ˜å®é™…ä½¿ç”¨çš„å·¥å…·
3. **æ¸…æ™°çš„è¾“å‡ºæ ¼å¼**ï¼šå®šä¹‰æœºå™¨å¯è§£æçš„è¾“å‡ºç»“æ„

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–å·¥å…·é“¾

```powershell
# è¿è¡Œå·¥å…·å®‰è£…è„šæœ¬
. .factory/scripts/setup-tools.ps1
```

### 2. éªŒè¯é…ç½®

```bash
# åœ¨ droid ä¸­æ‰§è¡Œ
/hooks
```

### 3. ä½¿ç”¨æŠ€èƒ½

```
/plan skill:task-planner
```

### 4. å§”æ‰˜å­ä»£ç†

```
DELEGATE:coder "å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½"
```

## ğŸ§¹ ç»´æŠ¤ä»»åŠ¡

### å®šæœŸæ¸…ç†

```powershell
# æ‰‹åŠ¨æ¸…ç†æ—§æ—¥å¿—
Remove-Item -Path ".factory/logs/*" -Recurse -Force -Include "*.log.*.gz"
```

### æ›´æ–°ç»éªŒæ•™è®­

ç¼–è¾‘ `.factory/lessons.md` è®°å½•æ–°çš„ç»éªŒæ•™è®­ã€‚

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Factory CLI å‚è€ƒ](https://docs.factory.ai/reference/cli-reference)
- [Hooks å‚è€ƒ](https://docs.factory.ai/reference/hooks-reference)
- [Hooks æŒ‡å—](https://docs.factory.ai/cli/configuration/hooks-guide)

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**ï¼šHooks ä¼šæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¯·å®¡æŸ¥æ‰€æœ‰è„šæœ¬
2. **æ€§èƒ½**ï¼šè¿‡å¤šçš„ hooks å¯èƒ½å‡æ…¢æ“ä½œï¼Œä¿æŒç²¾ç®€
3. **å…¼å®¹æ€§**ï¼šWindows ç¯å¢ƒä¸‹ä½¿ç”¨ PowerShell è„šæœ¬
4. **ç‰ˆæœ¬æ§åˆ¶**ï¼š`.factory/settings.json` åº”è¯¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼Œä½† `settings.local.json` ä¸åº”æäº¤
